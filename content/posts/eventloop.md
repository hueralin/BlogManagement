---
title: "JS 事件循环"
date: 2019-09-02T18:56:56+08:00
draft: false
categories: ['随便学学']
---

[MDN 事件循环](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop)



![从MDN上盗个图](/img/posts/eventloop.svg)

### 栈  

由函数调用组成的栈，也被称为 “执行栈” ，函数被调用时压入栈，执行完毕弹出栈。结合 [JS执行环境](http://localhost:1313/2019/jsec/) 中所讲的内容，函数调用栈中的每一个帧都是一个执行环境，执行环境里面包含着变量对象（函数被调用时才会有）。  

### 堆  

存放对象等非结构化的数据。  

### 队列  

**待处理** 的消息队列，队列中的每一个消息都对应着一个消息处理函数。事件循环过程中，会处理最先进入消息队列的消息，将该消息出队，作为输入参数去调用与之关联的消息处理函数，函数的调用会入栈，执行完出栈，直到执行栈为空，然后再处理下一个消息。

拿一个简单的例子来说明：  
```javascript
console.log('start')
setTimeout(() => {
    console.log('time over!')
}, 0)
console.log('end')
// start
// end
// time over!
```
即使延迟设置为0也不会立即执行，setTimeout的延迟时间是最小延迟时间，即最少也需要xxx时间才会把回调函数放入消息队列。**注意！是放进消息队列，而不是执行回调函数**，好多人都会认为这里是到时间后执行回调函数，其实是到时间后将事件处理函数放入消息队列，然后等待被执行。**所有的事件都是这样，满足条件后将事件处理函数放入消息队列，然后等待事件循环到它时才会被执行。**
